{
  "guid": "http://blog.wildsky.cc/?p=929",
  "date": "2019-05-22T15:11:55",
  "slug": "syntax-error-unexpected-token-when-react-script-test",
  "link": "/en/posts/syntax-error-unexpected-token-when-react-script-test/",
  "title": "SyntaxError: Unexpected token when using react-script test",
  "excerpt": "<p>Environment I created my project by create-react-app, a&#8230;</p>\n",
  "feature_image_url": "https://backend.wildsky.cc/wp-content/uploads/2019/05/螢幕快照-2019-05-22-15.06.12.png",
  "content": "\n<h2>Environment</h2>\n\n\n\n<p>I created my project by create-react-app, and running test using its <code>react-script test</code>.</p>\n\n\n\n<ul><li>node version: 10.15.3</li><li>npm version: 6.4.1</li><li>react-scripts: 3.0.1</li></ul>\n\n\n\n<h2>What happened? </h2>\n\n\n\n<p>When running test command (<code>npm run test</code>), I got this error message:</p>\n\n\n\n<!--more-->\n\n\n\n<pre class=\"wp-block-code\"><code>  ● Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    This usually means that you are trying to import a file which Jest cannot parse, e.g. it's not plain JavaScript.\n\n    By default, if Jest sees a Babel config, it will use that to transform your files, ignoring \"node_modules\".\n\n    Here's what you can do:\n     • To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     • If you need a custom transformation specify a \"transform\" option in your config.\n     • If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/en/configuration.html\n\n    Details:\n\n    /Users/wildsky/Projects/ailabs/pttai.js/node_modules/webrtc-adapter/src/js/adapter_core5.js:12\n    import {adapterFactory} from './adapter_factory.js';\n           ^\n\n    SyntaxError: Unexpected token {\n\n      at ScriptTransformer._transformAndBuildScript (node_modules/@jest/transform/build/ScriptTransformer.js:471:17)\n      at ScriptTransformer.transform (node_modules/@jest/transform/build/ScriptTransformer.js:513:25)\n      at Object.&lt;anonymous> (node_modules/react-qr-reader/lib/index.js:28:1)</code></pre>\n\n\n\n<p>Okay, it seems that jest would not transform files below <code>node_modules</code>. (And here is the jest config used by react-script: <a href=\"https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/scripts/utils/createJestConfig.js#L50\">createJestConfig.js#L50</a>)</p>\n\n\n\n<p>Therefore, we need to overwrite that configure. Lots of information would tell you add <code>transformIgnorePatterns</code> config into <code>package.json</code>, but you will find you can&#8217;t do it with this error.</p>\n\n\n\n<pre class=\"wp-block-code\"><code>Out of the box, Create React App only supports overriding these Jest options:\n\n  • collectCoverageFrom\n  • coverageReporters\n  • coverageThreshold\n  • extraGlobals\n  • globalSetup\n  • globalTeardown\n  • resetMocks\n  • resetModules\n  • snapshotSerializers\n  • watchPathIgnorePatterns.\n\nThese options in your package.json Jest configuration are not currently supported by Create React App:\n\n  • transformIgnorePatterns\n\nIf you wish to override other Jest options, you need to eject from the default setup. You can do so by running npm run eject but remember that this is a one-way operation. You may also file an issue with Create React App to discuss supporting more options out of the box.\n\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</code></pre>\n\n\n\n<p>but no worry, jest provide cli option for you, just add this into the test script command:</p>\n\n\n\n<pre class=\"wp-block-code\"><code>--transformIgnorePatterns 'node_modules/(?!(&lt;package-need-to-transform>|&lt;other-package-need-to-transform>)/)'</code></pre>\n\n\n\n<p>so it will become like this:</p>\n\n\n\n<pre class=\"wp-block-code\"><code>// package.json\n\n{\n...\n  \"scripts\": {\n    ...\n    \"test\": react-scripts test --env=jsdom --transformIgnorePatterns 'node_modules/(?!(&lt;package-need-to-transform>|&lt;other-package-need-to-transform>)/)'\n    ...\n  }\n...\n}</code></pre>\n\n\n\n<p>and jest will run without the SyntaxError. That&#8217;s it!</p>\n\n\n\n<h2>References</h2>\n\n\n\n<ul><li><a href=\"https://github.com/facebook/create-react-app/issues/2537#issuecomment-390341713\">https://github.com/facebook/create-react-app/issues/2537#issuecomment-390341713</a></li><li><a href=\"https://github.com/facebook/create-react-app/issues/5241#issuecomment-426986623\">https://github.com/facebook/create-react-app/issues/5241#issuecomment-426986623</a></li><li><a href=\"https://facebook.github.io/create-react-app/docs/running-tests\">https://facebook.github.io/create-react-app/docs/running-tests</a></li></ul>\n"
}