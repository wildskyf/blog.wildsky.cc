---
title: "è®€ã€Œæˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿã€å¾Œ"
date: 2018-11-11T14:07:41+08:00
draft: false
categories:
  - Web
tags:
  - note
  - f2e
  - JavaScript
---

æœ€è¿‘è®€äº†æµ·ç¸½çš„ã€Šæœ¬æœ«å€’ç½®çš„é–±è®€ç¿’æ…£ã€‹ï¼Œç™¼ç¾è‡ªå·±ä¹Ÿæœ‰é€™å€‹å£ç¿’æ…£ã€‚
æƒ³è¦ä¾†å¥½å¥½åœ°æ³¨æ„é€™å€‹å•é¡Œï¼Œé¿å…åªç ¸æ™‚é–“åœ¨ä¸ç”¨ç´°è®€çš„æ–‡ç« ã€‚

å‰›å¥½å°èŸ¹è²¼äº†é€™ç¯‡
[ã€Šæˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿã€‹](æˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿ)
çµ¦æˆ‘ï¼Œä¾¿æ±ºå®šåœ¨èˆ’æœçš„å‡æ—¥åˆå¾Œå¥½å¥½åœ°é–±è®€ä¸€ä¸‹ã€‚
é€™ç¯‡æ–‡ç« å°±æ˜¯åœ¨è¨˜éŒ„è‡ªå·±é–±è®€éç¨‹ä¸­çš„ murmurï¼Œé †ä¾¿æ‘˜ä¸€ä¸‹ï¼Œ
ç•¥å¾®åœ°å¸Œæœ›å¯ä»¥æ›¿æœªä¾†çš„è‡ªå·±çœä¸‹é‡æ–°é–±è®€çš„æ™‚é–“ã€‚

æ–‡ä¸­åˆ—äº†åå€‹ç†è§£ç¨‹åº¦ï¼š

1. ä½ çŸ¥é“ä»€éº¼æ˜¯ hoisting
2. ä½ çŸ¥é“ hoisting åªæœƒæå‡å®£å‘Šè€Œéè³¦å€¼
3. ä½ çŸ¥é“ function å®£å‘Šã€function çš„åƒæ•¸ä»¥åŠä¸€èˆ¬è®Šæ•¸å®£å‘ŠåŒæ™‚å‡ºç¾æ™‚çš„æå‡å„ªå…ˆé †åº
4. ä½ çŸ¥é“ let è·Ÿ const æ²’æœ‰ hoisting
5. ä½ çŸ¥é“ç¬¬äº”é»æ˜¯éŒ¯çš„ï¼Œå…¶å¯¦æœ‰ä½†åªæ˜¯è¡¨ç¾å½¢å¼ä¸ä¸€æ¨£
6. ä½ çŸ¥é“æœ‰é—œç¬¬å…­é»ï¼Œæœ‰å€‹æ¦‚å¿µå«åš TDZï¼ˆTemporal Dead Zoneï¼‰
7. ä½ çœ‹é ES3 çš„è¦æ ¼æ›¸ï¼ŒçŸ¥é“è£¡é¢æ˜¯æ€éº¼æè¿°çš„
8. ä½ çœ‹é ES6 çš„è¦æ ¼æ›¸ï¼ŒçŸ¥é“è£¡é¢æ˜¯æ€éº¼æè¿°çš„
9. ä½ çŸ¥é“ hoisting èƒŒå¾Œçš„åŸç†æ˜¯ä»€éº¼
10. ä½ çœ‹é V8 ç·¨è­¯å‡ºä¾†çš„ç¨‹å¼ç¢¼

çœ‹å®Œæ–‡ç« å¾Œï¼Œé™¤äº† 8, 10 ä¹‹å¤–ï¼Œæˆ‘é€™æ¬¡æ‡‰è©²éƒ½æœ‰å®Œå…¨å¸æ”¶ï¼Œé€™å…©å€‹å•é¡Œå¯èƒ½éœ€è¦è‡ªå·±å»è®€éã€è·‘éã€
è¦ªèº«å˜—è©¦éæ‰æœƒå¸æ”¶å¾—æ›´æ·±åˆ»ã€‚

## hoisting çš„è¦å‰‡

> 1. è®Šæ•¸å®£å‘Šè·Ÿå‡½å¼å®£å‘Šéƒ½æœƒæå‡ï¼Œå‡½å¼å®£å‘Šè¼ƒå„ªå…ˆ
> 2. åªæœ‰å®£å‘Šæœƒæå‡ï¼Œè³¦å€¼ä¸æœƒæå‡
> 3. åˆ¥å¿˜äº†å‡½å¼è£¡é¢é‚„æœ‰å‚³é€²ä¾†çš„åƒæ•¸ï¼Œæœƒåœ¨æå‡å¾Œè³¦å€¼

è®€å®Œé€™é‚Šå°±è®“æˆ‘æƒ³èµ·ä¹‹å‰åœ¨ function ä¸­è·‘é è¨­å€¼è™•ç†æ™‚ï¼Œ
è¼¸å‡ºæœ‰é»æ€ªæ€ªçš„ï¼Œçœ‹åˆ°é€™é‚Šæ–‡å°±å¯ä»¥ç†è§£è¦å‰‡ï¼Œä¸¦çŸ¥é“ã€Œæ€ªã€å‡ºç¾çš„åŸå› ï¼Œ
å¯¦éš›é‹ä½œçš„åŸç†é‚„è¦å†å¾€å¾Œè®€ã€‚

ä¸éåœ¨è¬›åŸç†ä¹‹å‰ï¼Œæœƒå…ˆå•é€™å…©å€‹å•é¡Œï¼š

> 1. ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ hoistingï¼Ÿ
> 2. Hoisting åˆ°åº•æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ

## 1. ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ hoistingï¼Ÿ

ç°¡å–®èªªå°±æ˜¯æƒ³è¦å…©å€‹æ±è¥¿ï¼š

1. mutual recursion
2. avoid painful bottom-up ML-like order

ç¬¬äºŒå€‹é‚„ä¸å¤ªæ‡‚æ˜¯ä»€éº¼ï¼Œæ‰“ç®—å…ˆè¨˜ä¸‹ä¾†ï¼Œä¹‹å¾Œå†å»æŸ¥ã€‚

ref: <https://twitter.com/wildskyf/status/1061511004708790272>

## 2. Hoisting åˆ°åº•æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ

é‹ä½œåŸç†æ˜¯ï¼Œåœ¨è·‘ç¨‹å¼çš„æ™‚å€™å¾Œé¢æœƒæœ‰ Execution Context è¨˜éŒ„è©² scope ä¸‹çš„ç›¸é—œè³‡è¨Šï¼Œ
æœƒç”¨ä¸€å€‹å«åš Variable Objectï¼ˆç°¡ç¨± VOï¼‰çš„æ±è¥¿å»è¨˜éŒ„ã€‚

åœ¨è·‘ç¨‹å¼çš„æ™‚å€™ï¼Œå…¶å¯¦ä¸»è¦ä¹Ÿå°±æ˜¯ã€Œå–å€¼ã€èˆ‡ã€Œè³¦å€¼ã€é€™å…©ä»¶äº‹ï¼Œåªè¦é…åˆ VO çš„è¦å‰‡å°±å¯ä»¥å­¸
èµ·ä¾†äº†ã€‚é€™é‚Šæ˜¯é‹ä½œçš„é †åºï¼š

> 1. æŠŠåƒæ•¸æ”¾åˆ° VO è£¡é¢ä¸¦è¨­å®šå¥½å€¼ï¼Œå‚³ä»€éº¼é€²ä¾†å°±æ˜¯ä»€éº¼ï¼Œæ²’æœ‰å€¼çš„è¨­æˆ undefined
> 2. æŠŠ function å®£å‘Šæ”¾åˆ° VO è£¡ï¼Œå¦‚æœå·²ç¶“æœ‰åŒåçš„å°±è¦†è“‹æ‰
> 3. æŠŠè®Šæ•¸å®£å‘Šæ”¾åˆ° VO è£¡ï¼Œå¦‚æœå·²ç¶“æœ‰åŒåçš„å‰‡å¿½ç•¥ï¼ˆè·³éå®£å‘Šï¼‰

æ¥è‘—æœƒè¬›ç·¨è­¯å™¨èˆ‡ç›´è­¯å™¨çš„äº‹ï¼Œä»¥è§£ç­”ã€ŒJS ä¸æ˜¯ç›´è­¯çš„å—ï¼Ÿç‚ºä»€éº¼å¯ä»¥åšåˆ°æå‡ï¼Ÿã€çš„ç–‘æƒ‘ã€‚

## JS æ€éº¼åšåˆ° hoistingï¼Ÿ

å…¶å¯¦åªè¦ç ´é™¤ã€ŒJS æ˜¯ç›´è­¯èªè¨€ã€é€™å¥è©±æ‰€ç”¢ç”Ÿçš„èª¤è§£ï¼ŒçŸ¥é“ã€Œèªè¨€æ­¸èªè¨€ï¼Œå¯¦ä½œæ­¸å¯¦ä½œã€å°±å¯ä»¥è§£æƒ‘ã€‚

> èªè¨€ä¸€èˆ¬åªæœƒå®šç¾©æŠ½è±¡èªç¾©ï¼Œä¸æœƒå¼·åˆ¶ç”¨æŸç¨®æ–¹å¼å¯¦ç¾ï¼Œåƒæ˜¯ C æˆ‘å€‘æœƒèªªå®ƒæ˜¯ç·¨è­¯å‹èªè¨€ï¼Œå¯æ˜¯ C ä¹Ÿæœ‰ç›´è­¯å™¨ã€‚æ‰€ä»¥ç•¶æˆ‘å€‘åœ¨èªªæŸç¨®ç¨‹å¼èªè¨€æ˜¯ç›´è­¯æˆ–ç·¨è­¯å‹çš„æ™‚å€™ï¼Œå…¶å¯¦æ˜¯åœ¨æŒ‡æ¶‰ã€Œå¤§å¤šæ•¸ã€è€Œä¸æ˜¯å…¨éƒ¨ã€‚

> å¾ˆå¤šç¨®ç›´è­¯å™¨å…§éƒ¨çš„é‹ä½œæ–¹å¼éƒ½æ˜¯å…ˆæŠŠåŸå§‹ç¢¼ç·¨è­¯æˆæŸç¨®ä¸­é–“ç¢¼å†å»åŸ·è¡Œï¼Œæ‰€ä»¥ç·¨è­¯é€™å€‹æ­¥é©Ÿé‚„æ˜¯å¾ˆå¸¸è¦‹çš„ï¼Œè€Œ JS ä¹Ÿæ˜¯é€™æ¨£é‹ä½œçš„ã€‚

æœ‰äº†é€™å€‹è§€å¿µå°±å¯ä»¥æŠŠ JS çš„åº•å±¤ç†è§£å»ºç«‹èµ·ä¾†ï¼Œ
æœªä¾†é‡åˆ°å•é¡Œå…ˆæœ‰é€™å€‹åº•çš„è©±ï¼Œæ‡‰è©²æœƒæ›´å®¹æ˜“è±ç„¶é–‹æœ—ã€‚

å¾Œé¢é‚„è¬›äº† Temporal Dead Zoneï¼š

> let èˆ‡ const ç¢ºå¯¦æœ‰ hoistingï¼Œèˆ‡ var çš„å·®åˆ¥åœ¨æ–¼æå‡ä¹‹å¾Œï¼Œ
var å®£å‘Šçš„è®Šæ•¸æœƒè¢«åˆå§‹åŒ–ç‚º undefinedï¼Œ
è€Œ let èˆ‡ const çš„å®£å‘Šä¸æœƒè¢«åˆå§‹åŒ–ç‚º undefinedï¼Œ
è€Œä¸”å¦‚æœä½ åœ¨ã€Œè³¦å€¼ä¹‹å‰ã€å°±å­˜å–å®ƒï¼Œå°±æœƒæ‹‹å‡ºéŒ¯èª¤ã€‚

TDZ å°±æ˜¯æœƒæ‹‹å‡ºéŒ¯èª¤çš„é‚£æ®µã€Œæ™‚é–“ã€ã€‚ï¼ˆé€™è£¡çš„ Zone æ˜¯åŸ·è¡Œçš„æ™‚é–“é †åºï¼Œä¸æ˜¯ç¨‹å¼ç¢¼é †åºï¼‰

## V8 ç¨‹å¼ç¢¼çš„å¯¦ä½œ

ç„¶å¾Œæœ€å¾Œé¢æœ‰é»ä¸æ„å¤–åœ°ï¼Œåˆè¬›åˆ° V8 ğŸ˜‚ å› ç‚ºä½œè€…å¥½å¥‡ã€ŒV8 ç·¨è­¯å‡ºä¾†çš„ç¨‹å¼ç¢¼åˆ°åº•é•·æ€æ¨£ï¼Ÿã€

ä½œè€…å¾ˆç´°å¿ƒåœ°æŠŠ bytecode ç·¨å‡ºä¾†ï¼Œä¸¦åŠ ä¸Šè¨»è§£ï¼Œç´°çœ‹å¯ä»¥çŸ¥é“ hoisting åœ¨ V8 ä¸­åˆ°åº•æ˜¯å¦‚ä½•é‹ä½œçš„ã€‚

ç„¶å¾Œå°±æœƒè¦ºå¾—ä½œè€…çœŸæ˜¯å¤ªç¡¬æ´¾äº†ã€‚æˆ‘æ‰¿èªé€™æ®µæˆ‘åªæœ‰è‰è‰åœ°çœ‹éå»ï¼Œä¹Ÿè¨±è¦åˆ°æœªä¾†æƒ³è®€åŸ
å§‹ç¢¼çš„æ™‚å€™æ‰æœƒå»çœ‹ã€‚

## çµèª

> JavaScript å¸¸è€ƒçš„å¹¾å€‹é»å¤§å®¶éƒ½è€³ç†Ÿèƒ½è©³ï¼š
thisã€prototypeã€clousre è·Ÿ hoistingï¼Œè€Œé€™å¹¾å€‹çœ‹ä¼¼ä¸ç›¸é—œçš„æ±è¥¿ï¼Œ
å…¶å¯¦åªè¦ä½ èƒ½ç†è§£ JavaScript èƒŒå¾Œçš„é‹ä½œæ¨¡å‹ï¼Œéƒ½èƒ½å¤ å¤šå°‘ä¸²å¾—èµ·ä¾†ï¼Œæˆç‚ºä¸€å€‹å®Œæ•´çš„ç†è«–ã€‚

æˆ‘ç¾åœ¨é‚„åœåœ¨ã€ŒçŸ¥é“ä»–å€‘æ˜¯ä»€éº¼ã€çš„éšæ®µï¼Œçœ‹ä¾†ä¹‹å¾Œè¦ç´°ç´°åœ°å»ä¸€å€‹ä¸€å€‹æŠ“å‡ºä¾†ç†è§£ä¸€ä¸‹ã€‚
æŠŠä»–å€‘çš„è¦å‰‡å’Œé‹ä½œåŸç†å¹«åœ¨ä¸€èµ·é€šé€šæ‡‚ä¸€è¼ªï¼Œæ‰èƒ½åœ¨æœ‰æœä¸€æ—¥ååˆ†æœ‰ä¿¡å¿ƒåœ°èªªå‡ºã€Œæˆ‘æ‡‚ JSã€ã€‚

## åŸæ–‡æåˆ°çš„å»¶ä¼¸é–±è®€

- [è™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ©](http://rednaxelafx.iteye.com/blog/492667)
- [ECMA-262-5 in detail. Chapter 3.2. Lexical environments: ECMAScript implementation.](http://dmitrysoshnikov.com/ecmascript/es5-chapter-3-2-lexical-environments-ecmascript-implementation/)
- [JS ä½œç”¨åŸŸ](https://github.com/nightn/front-end-plan/blob/master/js/js-scope.md)
- [è§£è¯»ECMAScript[1]â€”â€”æ‰§è¡Œç¯å¢ƒã€ä½œç”¨åŸŸåŠé—­åŒ…](https://www.cnblogs.com/leoo2sk/archive/2010/12/19/ecmascript-scope.htm)

## å…¶ä»–ç›¸é—œé€£çµ

- [ã€Šæˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿã€‹](æˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿ)
- [æµ·ç¸½](https://twitter.com/tzangms/) çš„ [ã€Šæœ¬æœ«å€’ç½®çš„é–±è®€ç¿’æ…£ã€‹](https://tzangms.com/put-the-cart-before-the-horse-reading-habits/)
- [å°èŸ¹](http://twitter.com/wildjcrt)
- [æœ¬æ–‡çš„ murmur æ¨æ–‡ç‰ˆ](https://twitter.com/wildskyf/status/1061511004708790272)

